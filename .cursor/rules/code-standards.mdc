---
description: "代码规范、错误处理和 API 响应格式"
alwaysApply: true
---

# 代码规范

## 通用规范
- 按功能模块组织代码，保持函数单一职责
- 提取可复用的工具函数，使用有意义的变量和函数名
- 添加必要的中文注释
- 文件与目录使用 kebab-case

## 错误处理
- 使用统一的错误响应格式（通过 `createErrorResponse`）
- 记录错误日志（`console.error`）
- 不向客户端暴露敏感错误信息
- 错误信息应清晰、可操作

## 响应格式
所有 API 响应使用统一格式，通过 `server/utils/response.js`：

### 成功
- `createSuccessResponse(data, status)` → `{ success: true, data }`

### 错误
- `createErrorResponse(message, code, status, details)` → `{ success: false, error: { message, code, details? } }`

### 分页
- `createPaginatedResponse(items, total, page, limit)` → `{ success: true, data: { items, total, page, limit, totalPages } }`

返回时使用 `sendJson(res, payload)` 设置 status 并 `res.json(payload)`。

## 代码组织
- 路由在 `server/routes/`，按功能分文件
- 服务在 `server/services/`，封装 OSS、钉钉等
- 中间件在 `server/middleware/`（如鉴权）
- 工具在 `server/utils/`
