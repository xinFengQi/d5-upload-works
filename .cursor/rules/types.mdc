---
description: "数据结构与约定（无 TypeScript 时的数据形状）"
globs:
  - "server/**/*.js"
---

# 数据约定

## 用户与会话
- **users**：userid(PK), name, avatar, mobile, email, role, created_at
- **sessions**：token(PK), userid, expires_at, created_at
- 当前用户对象（req.user）：`{ userid, name, avatar?, mobile?, email?, role }`

## 作品
- **works**：id(PK), userid, title, description?, file_url, file_name, file_size, file_type, creator_name?, created_at, updated_at
- API 返回字段使用 camelCase：fileUrl, fileName, creatorName, createdAt, updatedAt, voteCount（列表/ top 时）

## 投票
- **votes**：work_id, user_id, created_at，主键 (work_id, user_id)
- 每人每作品一票；每人最多投票数由 screen_config.max_votes_per_user 配置（1–100），管理员与普通用户一致

## 评委评分
- **judge_scores**：work_id, judge_email, score(1–100), created_at，主键 (work_id, judge_email)
- **work_judge_score**：work_id(PK), score(平均分), judge_count, updated_at
- 评委身份由 screen_config.judges_json 中的邮箱判定

## 大屏与系统配置
- **screen_config**：id=1, grid_layout, theme_json, max_votes_per_user, judges_json, vote_open_start, vote_open_end, score_open_start, score_open_end, updated_at
- theme 为 JSON：primaryColor, primaryDark, primaryLight, secondaryColor（十六进制）
- 开放时间为时间戳（ms），null 表示不限制

## API 响应
- 成功：`{ success: true, data: T }`
- 失败：`{ success: false, error: { message, code, details? } }`
- 分页：`data: { items, total, page, limit, totalPages }`
