---
description: "API 路由规范（Express）"
globs:
  - "server/routes/**/*.js"
  - "server/app.js"
---

# 路由规范

## 结构
- 使用 Express Router，在 `server/app.js` 中挂载
- 统一使用 `server/utils/response.js` 的 `sendJson`、`createSuccessResponse`、`createErrorResponse`、`createPaginatedResponse`

## 认证
- 需要登录：使用 `requireUser` 中间件（`server/middleware/auth.js`）
- 仅管理员：使用 `requireAdmin` 中间件
- 从 `req.user` 取当前用户（userid、name、role 等）

## API 端点

### 认证 /auth
- `GET /auth/dingtalk`：重定向到钉钉
- `GET /auth/callback`：钉钉回调，写 session 后重定向
- `GET /auth/me`：当前用户信息（Bearer）
- `POST /auth/admin`：管理员登录，body `{ password }`
- `POST /auth/logout`：退出（Bearer）

### 上传 /api/upload
- `POST /api/upload`：multipart，字段 `file`、`title`，需登录

### 作品 /api/works
- `GET /api/works`：分页列表，query `page`、`limit`
- `GET /api/works/top`：按投票数排序，query `limit`
- `DELETE /api/works/:workId`：仅管理员

### 投票 /api/vote
- `POST /api/vote`：body `{ workId }`，需登录
- `DELETE /api/vote`：query `workId`，需登录
- `GET /api/vote/user/count`：当前用户已投票数，需登录
- `GET /api/vote/stats`：query `workId`，返回 voteCount、hasVoted
- `GET /api/vote/users`：query `workId`，投票用户列表，仅管理员

### 大屏配置 /api/screen-config
- `GET /api/screen-config`：返回 gridLayout、theme、updatedAt
- `POST /api/screen-config`：body `{ gridLayout?, theme? }`，仅管理员

## 前端页面
静态文件在 `frontend/public/`，路径映射在 `app.js` 中：`/` → index.html，`/login` → login.html，`/upload` → upload.html，`/admin` → admin.html，`/screen` → screen.html，`/multi-screen` → multi-screen.html，`/vote-result` → vote-result.html。
